/*
    Example for 16x12_G Click

        Date          : July 2017
        Author        : Irena Blagojevic

    Test configuration KINETIS :

        MCU             : MK64
        Dev. Board      : HEXIWEAR
        SW              : mikroC PRO for ARM v.5.1.0

    Description :

        This example shows basic usage of 16x12 G click driver, how to
        initialize the device, turn on desired LEDs in the matrix in the
        default mode and in Auto Breath Mode.

*/

#include "__IS31FL3733_Driver.h"
sbit IS31FL3733_SDB_PIN at PTC_PDOR.B4;
sbit IS31FL3733_RST_PIN at PTB_PDOR.B11;

void systemInit()
{
     GPIO_Digital_Output( &PTC_PDOR, _GPIO_PINMASK_4 );
     GPIO_Digital_Output( &PTB_PDOR, _GPIO_PINMASK_11 );

     I2C0_Init_Advanced( 100000, &_GPIO_Module_I2C0_PD8_9 );
     Delay_ms( 200 );
}

void main()
{
    T_IS31FL3733 instance;
    T_IS31FL3733_ABM abmInstance;
    uint8_t i;
    static const uint8_t pattern[] = {
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x44,0x00,0x00,0x00,0x00,0x00,0x44,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0xa0,0x00,0x00,0x00,0xa0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0xff,0x00,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0xff,0x00,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0xa0,0x00,0x00,0x00,0xa0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x44,0x00,0x00,0x00,0x00,0x00,0x44,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
        0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
    };

    systemInit();
    IS31FL3733_init( &instance, _IS31FL3733_GND_ADDR, _IS31FL3733_GND_ADDR,
                     I2C0_Start, I2C0_Write, I2C0_Read );
    IS31FL3733_setGCC( &instance, 64 );

    // PWM control mode (default)
    for( i = 0; i < _IS31FL3733_CS; ++i )
    {
        // Set PWM values for all LEDs at i-th row to 55/255 level.
        IS31FL3733_setLEDPWM ( &instance, i, _IS31FL3733_SW, 55 );
        // Turn on selected LEDs.
        IS31FL3733_setLEDState ( &instance, i, _IS31FL3733_SW,
                                 _IS31FL3733_LED_STATE_ON );
    }

    // Clear the matrix
    IS31FL3733_clearMatrix( &instance );

    // Auto Breath Mode (ABM)
    // Turn on LEDs for given pattern.
    IS31FL3733_setState( &instance, (uint8_t*)pattern );
    // Configure all matrix LEDs to work in ABM1 mode.
    IS31FL3733_setLEDMode( &instance, _IS31FL3733_CS, _IS31FL3733_SW,
                           IS31FL3733_LED_MODE_ABM1 );
    // Set ABM mode structure parameters.
    abmInstance.T1 = IS31FL3733_ABM_T1_840MS;
    abmInstance.T2 = IS31FL3733_ABM_T2_840MS;
    abmInstance.T3 = IS31FL3733_ABM_T3_840MS;
    abmInstance.T4 = IS31FL3733_ABM_T4_840MS;
    abmInstance.begin = IS31FL3733_ABM_LOOP_BEGIN_T1;
    abmInstance.end = IS31FL3733_ABM_LOOP_END_T3;
    abmInstance.times = IS31FL3733_ABM_LOOP_FOREVER;
    // Write ABM structure parameters to device registers.
    IS31FL3733_configABM( &instance, IS31FL3733_ABM_NUM_1, &abmInstance );
    // Start ABM mode operation.
    IS31FL3733_startABM( &instance );
}
